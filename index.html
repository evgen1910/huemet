<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ö–Ω–æ–ø–∫–∞ —Å—É–¥—å–±—ã ‚Äî turbo edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --fg:#e7e9ee; --muted:#9aa3b2; --accent:#8ee159;
      --bg0:#0f1115; --bg1:#141821; --panel:#141821; --border:#252a34;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      display:grid; place-items:center; color:var(--fg);
      font-family: ui-sans-serif,-apple-system,Segoe UI,Roboto,Inter,system-ui,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 50% 30%, #181b22, var(--bg0));
      transition: background 600ms ease;
    }
    .wrap{width:min(960px,92vw); text-align:center; padding:24px}
    h1{margin:0 0 18px; color:var(--muted); font-size:clamp(18px,2.8vw,24px); font-weight:600}
    #screen{
      min-height:32vh; display:grid; place-items:center; padding:24px;
      border:1px solid var(--border); background:var(--panel); border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.02);
      transition: background 600ms ease, border-color 600ms ease, transform 300ms ease;
    }
    #text{
      font-size: clamp(26px, 5.2vw, 56px);
      font-weight: 800; line-height:1.15; letter-spacing:.02em; text-wrap:balance;
      text-shadow: 0 0 10px rgba(142,225,89,0.25);
    }
    .blink{ animation: blink 1.2s linear infinite; }
    @keyframes blink{ 0%,100%{opacity:1} 50%{opacity:.35} }

    .controls{margin-top:20px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap}
    button{
      appearance:none; border:none; border-radius:12px; padding:14px 22px;
      font-size:18px; font-weight:700; cursor:pointer; color:#0d1117;
      background:linear-gradient(180deg, var(--accent), #7adb3f);
      box-shadow:0 8px 18px rgba(142,225,89,.25), inset 0 -2px 0 rgba(0,0,0,.1);
      transition: transform .04s ease, filter .2s ease, opacity .2s ease;
    }
    button:hover{filter:brightness(1.03)}
    button:active{transform: translateY(1px) scale(.99)}
    button.secondary{ background:#232a36; color:var(--fg); box-shadow: inset 0 0 0 1px #2f3846; }
    button:disabled{opacity:.6; cursor:not-allowed}
    footer{margin-top:14px; color:var(--muted); font-size:12px; opacity:.9; user-select:none}

    /* –§–æ–Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
    body[data-stage="charge"]{
      background: radial-gradient(1000px 600px at 50% 30%, #1a2330, #0c0f16);
    }
    body[data-stage="ready"]{
      background: radial-gradient(1000px 600px at 50% 30%, #0f1626, #090b11);
    }
    body[data-stage="work"]{
      background: radial-gradient(1100px 640px at 50% 25%, #162a1a, #0a110b);
    }
    body[data-stage="send"]{
      background: radial-gradient(1100px 640px at 50% 25%, #23152d, #0a0611);
    }
    body[data-stage="done"]{
      background: radial-gradient(1200px 680px at 50% 25%, #1d2438, #0b1021);
    }

    /* –•–æ–ª—Å—Ç –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ */
    #confetti {
      position: fixed; inset: 0; pointer-events: none; z-index: 10;
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <div class="wrap">
    <h1>–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Äî –∏ –Ω–µ –≥–æ–≤–æ—Ä–∏, —á—Ç–æ —Ç–µ–±—è –Ω–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–ª–∏</h1>

    <div id="screen">
      <div id="text">–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É</div>
    </div>

    <div class="controls">
      <button id="startBtn" aria-controls="text">–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É</button>
      <button id="resetBtn" class="secondary" hidden>–°–±—Ä–æ—Å–∏—Ç—å</button>
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ¬´–∫–∞–∫–∏–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏¬ª -->
      <button id="toggleEmoji" class="secondary" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–∏–ø –∫–æ–Ω—Ñ–µ—Ç—Ç–∏">–ö–æ–Ω—Ñ–µ—Ç—Ç–∏: üçÜ</button>
      <button id="muteBtn" class="secondary" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫">–ó–≤—É–∫: üîä</button>
    </div>

    <footer>¬© –î—Ä—É–∂–µ—Å–∫–∞—è —à—É—Ç–∫–∞. –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ ‚Äî —ç–º–æ–¥–∑–∏/–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, –±–µ–∑ —è–≤–Ω—ã—Ö –≥–µ–Ω–∏—Ç–∞–ª–∏–π.</footer>
  </div>

  <script>
    /* ---------- DOM ---------- */
    const textEl   = document.getElementById('text');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const toggleEmojiBtn = document.getElementById('toggleEmoji');
const muteBtn  = document.getElementById('muteBtn');

    /* ---------- Helpers ---------- */
    const sleep = ms => new Promise(r => setTimeout(r, ms));
    const rnd   = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    function showMessage(str, {blink=false, stage=null} = {}) {
      textEl.textContent = str;
      textEl.classList.toggle('blink', blink);
      if (stage) document.body.setAttribute('data-stage', stage);
    }

    /* ---------- –ê–£–î–ò–û: ¬´–í–£–£–•¬ª ---------- */
    let audioCtx = null, soundMuted = false;
    function ensureAudio() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    function playWhoosh(duration=0.5){
      if (soundMuted) return;
      ensureAudio();

      // White noise buffer
      const sampleRate = audioCtx.sampleRate;
      const length = Math.floor(sampleRate * duration);
      const buffer = audioCtx.createBuffer(1, length, sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0;i<length;i++) data[i] = (Math.random()*2-1);

      const src = audioCtx.createBufferSource(); src.buffer = buffer;

      // –§–∏–ª—å—Ç—Ä—ã + –æ–≥–∏–±–∞—é—â–∞—è
      const hp = audioCtx.createBiquadFilter(); hp.type = 'highpass'; hp.frequency.value = 400;
      const lp = audioCtx.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 8000;

      const gain = audioCtx.createGain(); gain.gain.value = 0.0001;

      // –ø—Ä–æ—Å—Ç–∞—è –æ–≥–∏–±–∞—é—â–∞—è
      const now = audioCtx.currentTime;
      gain.gain.cancelScheduledValues(now);
      gain.gain.setValueAtTime(0.0001, now);
      gain.gain.exponentialRampToValueAtTime(0.4, now + 0.08);
      gain.gain.exponentialRampToValueAtTime(0.001, now + duration);

      // sweep
      hp.frequency.setValueAtTime(400, now);
      hp.frequency.exponentialRampToValueAtTime(1200, now + duration);

      src.connect(hp).connect(lp).connect(gain).connect(audioCtx.destination);
      src.start();
      src.stop(now + duration + 0.02);
    }

    muteBtn.addEventListener('click', ()=>{
      soundMuted = !soundMuted;
      muteBtn.textContent = '–ó–≤—É–∫: ' + (soundMuted ? 'üîá' : 'üîä');
      if (!soundMuted) ensureAudio();
    });

    /* ---------- –ö–û–ù–§–ï–¢–¢–ò ---------- */
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let emojiMode = true; // true -> —ç–º–æ–¥–∑–∏; false -> –±—É–º–∞–∂–∫–∏
    const emojiSets = [
      ['üçÜ','üå≠','üöÄ','üéâ','üå∂Ô∏è'],
      ['üí•','‚ú®','üß®','üí´','üßÉ'] // –∑–∞–ø–∞—Å–Ω–æ–π –Ω–∞–±–æ—Ä
    ];
    let activeEmojiSet = 0;

    function resize(){
      canvas.width = innerWidth * devicePixelRatio;
      canvas.height = innerHeight * devicePixelRatio;
      ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
    }
    addEventListener('resize', resize); resize();

    class Particle {
      constructor(x, y, vX, vY, rot, rotV, size, color, char=null){
        this.x=x; this.y=y; this.vX=vX; this.vY=vY;
        this.rot=rot; this.rotV=rotV; this.size=size; this.color=color;
        this.char=char; this.life=0; this.maxLife=rnd(60,120);
      }
      step(){
        this.life++;
        // –ø—Ä–æ—Å—Ç–∞—è —Ñ–∏–∑–∏–∫–∞
        this.vY += 0.25; // gravity
        this.vX *= 0.995; this.vY *= 0.995; // air
        this.x += this.vX; this.y += this.vY;
        this.rot += this.rotV;
      }
      draw(){
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rot);
        if (this.char){
          ctx.font = ${this.size}px system-ui, Apple Color Emoji, Segoe UI Emoji;
          ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
          ctx.globalAlpha = 0.9;
          ctx.fillText(this.char, 0, 0);
        } else {
          ctx.globalAlpha = 0.9;
          ctx.fillStyle = this.color;
          // –±—É–º–∞–∂–∫–∞
          ctx.beginPath();
          ctx.roundRect(-this.size*0.6, -this.size*0.4, this.size*1.2, this.size*0.8, this.size*0.15);
          ctx.fill();
        }
        ctx.restore();
      }
      isDead(){ return this.life > this.maxLife || this.y > innerHeight + 80; }
    }
function burstConfetti({count=80, x=innerWidth/2, y=innerHeight*0.3, spread=Math.PI, power=10}={}){
      const palette = ['#8ee159','#54b4ff','#ff6ea9','#ffd166','#c58fff','#7cf0a5','#f6b26b'];
      for (let i=0;i<count;i++){
        const angle = (-Math.PI/2) + (Math.random()-0.5)*spread;
        const speed = power + Math.random()*power;
        const vX = Math.cos(angle)*speed;
        const vY = Math.sin(angle)*speed;
        const rot = Math.random()*Math.PI*2;
        const rotV = (Math.random()-.5)*0.2;
        const size = rnd(14, 28);

        if (emojiMode){
          const set = emojiSets[activeEmojiSet];
          const char = set[rnd(0, set.length-1)];
          particles.push(new Particle(x,y,vX,vY,rot,rotV,size,'',char));
        } else {
          const color = palette[rnd(0, palette.length-1)];
          particles.push(new Particle(x,y,vX,vY,rot,rotV,size,color,null));
        }
      }
    }

    function loop(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      particles.forEach(p=>{ p.step(); p.draw(); });
      particles = particles.filter(p=>!p.isDead());
      requestAnimationFrame(loop);
    }
    loop();

    toggleEmojiBtn.addEventListener('click', ()=>{
      if (emojiMode){
        // –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –±—É–º–∞–∂–∫–∏
        emojiMode = false; toggleEmojiBtn.textContent = '–ö–æ–Ω—Ñ–µ—Ç—Ç–∏: üéä';
      } else {
        emojiMode = true;
        // –º–µ–Ω—è–µ–º –Ω–∞–±–æ—Ä —ç–º–æ–¥–∑–∏ –ø–æ –∫—Ä—É–≥—É (üçÜ/üå≠/üöÄ/üéâ/üå∂Ô∏è ‚Ä¶)
        activeEmojiSet = (activeEmojiSet + 1) % emojiSets.length;
        const preview = emojiSets[activeEmojiSet][0];
        toggleEmojiBtn.textContent = –ö–æ–Ω—Ñ–µ—Ç—Ç–∏: ${preview};
      }
    });

    /* ---------- –ú–ò–õ–ï–°–¢–û–£–ù–´ ---------- */
    function generateMilestones(){
      const steps = rnd(3,5);
      let n = rnd(5,18);
      const incMin = 5, incMax = 40;
      const arr=[];
      for (let i=0;i<steps;i++){ n += rnd(incMin,incMax); arr.push(n); }
      return arr;
    }

    /* ---------- MAIN FLOW ---------- */
    async function run(){
      startBtn.disabled = true; resetBtn.hidden = true;

      const show = async (str, opts={})=>{
        showMessage(str, opts);
        await sleep(rnd(8000, 10000));
      };

      // –°—Ç–∞–¥–∏–∏
      await show('–•–£–ï–ú–ï–¢ –ó–ê–†–Ø–ñ–ê–ï–¢–°–Ø ‚Ä¶', {blink:true, stage:'charge'});
      await show('–•–£–ï–ú–ï–¢ –ó–ê–†–Ø–ñ–ï–ù‚Ä¶', {stage:'ready'});
      await show('–•–£–ï–ú–ï–¢–ê–¢–ï–õ–¨ –ì–û–¢–û–í‚Ä¶', {stage:'ready'});
      await show('–•–£–ï–ú–ï–¢ –ù–ê–ß–ò–ù–ê–ï–¢ –†–ê–ë–û–¢–ê–¢–¨‚Ä¶', {stage:'work'});

      // –ß–∏—Å–ª–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã
      const milestones = generateMilestones();
      for (const n of milestones){
        showMessage(`${n} –•–£–ï–í –û–¢–ü–†–ê–í–õ–ï–ù–û –ê–î–†–ï–°–ê–¢–£ ‚Ä¶`, {stage:'send'});
        playWhoosh(.42);
        burstConfetti({count: 60, y: innerHeight*0.28, power: 9, spread: Math.PI*0.9});
        await sleep(rnd(8000, 10000));
      }

      // –§–∏–Ω–∞–ª
      showMessage('–•–£–ò –î–û–°–¢–ê–í–õ–ï–ù–´ –ê–î–†–ï–°–ê–¢–£', {stage:'done'});
      playWhoosh(.7);
      // –ë–æ–ª—å—à–æ–π —Å–∞–ª—é—Ç
      burstConfetti({count: 180, y: innerHeight*0.3, power: 12, spread: Math.PI*1.2});
      await sleep(1000);

      resetBtn.hidden = false; startBtn.disabled = false;
      textEl.classList.remove('blink');
    }

    function reset(){
      showMessage('–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É');
      document.body.removeAttribute('data-stage');
      particles = [];
      resetBtn.hidden = true;
    }

    startBtn.addEventListener('click', run);
    resetBtn.addEventListener('click', reset);

    // iOS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∞—É–¥–∏–æ –ø–æ –ø–µ—Ä–≤–æ–º—É —Ç–∞–ø—É
    window.addEventListener('pointerdown', ()=>{ try{ ensureAudio(); }catch(e){} }, {once:true});
  </script>
</body>
</html>